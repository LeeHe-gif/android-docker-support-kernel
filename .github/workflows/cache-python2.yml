name: Cache-Python2

on:
  workflow_dispatch:  # 手动触发
  #schedule:
  #  - cron: '0 0 * * 0'  # 每周日 00:00 UTC 更新

jobs:
  update-cache:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install basic dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y curl wget build-essential gcc make

      - name: Cache Python 2.7
        uses: actions/cache@v4
        with:
          path: Python-2.7.18
          key: python-2.7.18
          restore-keys: |
            python-2.7.18
            
      - name: Build and Install Python 2.7 (if not exists and cache miss)
        run: |
          wget -q https://www.python.org/ftp/python/2.7.18/Python-2.7.18.tgz
          tar -xzf Python-2.7.18.tgz
          cd Python-2.7.18
          ./configure --enable-optimizations
          make -j$(nproc)
          
      - name: Save to cache
        uses: actions/cache@v3
        with:
          path: python-2.7.18
          key: python-2.7.18
          restore-keys: |
            python-2.7.18
            
      - name: Show cache info
        run: |
          echo "缓存已更新"
          echo "缓存key: python-2.7.18"
          echo "下次构建将使用此缓存"
